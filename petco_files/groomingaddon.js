ACC.groomingDatePicker={_autoload:["initialize","displayFormPetProfile","backToHomeGr","calendarFormat","sizeType","sendForm","ShowComboSpecies","ShowComboColor","bindScheduleAction","bindGroomingDatePicker","bindPetChange","bindPetButtonClick","bindServiceButtonClick","bindScheduleButtonClick","bindBookingSubmit","bindPetImageUpload","initGoogleMap"],storeId:"",longitude:"",latitude:"",initialize:function(){$('.account-section').removeClass('account-section');$('.account-section').addClass('clearfix');},bindGroomingDatePicker:function(){var todayDate=moment();var minGroomingDate=new Date();minGroomingDate.setDate(new Date().getDate()+1);minGroomingDate.setHours(0);minGroomingDate.setMinutes(0);$('#groomingDate').datetimepicker({defaultDate:minGroomingDate,locale:'es',format:'L HH:mm',collapse:true,sideBySide:true,minDate:minGroomingDate,enabledHours:[9,10,11,12,13,14,15,16,17,18,19,20,21],ignoreReadonly:true,});$(document).on('dp.change','#groomingDate',function(e){var options={weekday:'long',year:'numeric',month:'long',day:'numeric'};$("#groomingDateSelected").html(new Date(e.date.valueOf()).toLocaleDateString("es-MX",options));});},bindPetChange:function(){$(document).on("change","#pet",function(e){e.preventDefault();var url=ACC.config.encodedContextPath+"/booking/pet/"+$(this).val()+"/services";$.ajax({url:url,data:"",type:"GET",success:function(response){$("#idPetButton").removeAttr("disabled");$('#petService').empty();var optionEmpty=new Option($('#defaultPetService').val(),'');var defaultOption=$(optionEmpty);defaultOption.attr("disabled","disabled");defaultOption.attr("selected","selected");$('#petService').append(defaultOption);$.each(response.t,function(i,items){var option=new Option(items.name,items.code);$('#petService').append($(option));});}});});$(document).on("change","#petService",function(e){$("#idServiceButton").removeAttr("disabled");});},bindPetButtonClick:function(){$(document).on("click","#idPetButton",function(e){e.preventDefault();$("#petNameSelected").html($("#pet option:selected").text());$("#petId").val($("#pet").val());$("#changeServiceLink").show();$("#collapseService").collapse("toggle");});},bindServiceButtonClick:function(){$(document).on("click","#idServiceButton",function(e){e.preventDefault();$("#serviceNameSelected").html($("#petService option:selected").text());$("#serviceId").val($("#petService").val());$("#changeScheduleLink").show();$("#collapseSchedule").collapse("toggle");});},bindScheduleButtonClick:function(){$(document).on("click",".gm-schedule-action",function(e){e.preventDefault();var target=$(e.target);var selected=target.data("date");var slot=target.data("slot");var timeSpan=target.data("time");var visible=target.html();var panel=target.closest(".collapse");var infoTag=panel.parent().find(".gm-available-info");var selectedTag=panel.parent().find(".gm-selected-time");$(".gm-available-info").show();infoTag.hide();$(".gm-selected-time").html("");selectedTag.html(visible);panel.collapse("toggle");$("#scheduleSelected").html($("#displayDate").val()+" "+visible);$("#startDate").val(selected);$("#slotID").val(slot);$("#timeSpan").val(timeSpan);$("#collapseSchedule").collapse("toggle");$("#grm-vacc-checks").collapse("toggle");});$(document).on("click","#grm-vacc-label",function(e){$("#btnAppointmentBooking").removeAttr("disabled");});},bindBookingSubmit:function(){$(document).on("click","#btnAppointmentBooking",function(e){$("#btnAppointmentBooking").attr("disabled","disabled");var $form=$("#addBookingForm");var url=$form.attr('action');$.ajax({url:url,data:$form.serialize(),type:"POST",success:function(response){$.colorbox({transition:'none',opacity:0.5,maxWidth:"700px",maxHeight:"450px",width:"700px",height:"450px",title:'<span class="gr-response-title">Petco Grooming</span>',html:response,close:'<span class="glyphicon glyphicon-remove"></span>',onClosed:function()
{window.location.replace(ACC.config.encodedContextPath+"/store-finder");}});}});return false;});},initGoogleMap:function(){if($(".gm-js-store-finder-map").length>0){ACC.global.addGoogleMapsApi("ACC.groomingDatePicker.loadGoogleMap");}},loadGoogleMap:function(){storeId=$("#grm-pos-name").val();latitude=$("#grm-pos-lat").val();longitude=$("#grm-pos-lon").val();if($(".gm-js-store-finder-map").length>0)
{$(".gm-js-store-finder-map").attr("id","store-finder-map")
var centerPoint=new google.maps.LatLng(latitude,longitude);var mapOptions={zoom:13,zoomControl:true,panControl:true,streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,center:centerPoint}
var map=new google.maps.Map(document.getElementById("store-finder-map"),mapOptions);var marker=new google.maps.Marker({position:new google.maps.LatLng(latitude,longitude),map:map,title:storeId,icon:"https://maps.google.com/mapfiles/marker"+'A'+".png"});var infowindow=new google.maps.InfoWindow({content:storeId,disableAutoPan:true});google.maps.event.addListener(marker,'click',function(){infowindow.open(map,marker);});}},displayFormPetProfile:function(){$("#slectAllergies").click(function(){if($(this).is(":checked")){$("#showAllergies").show();$("#Hide").hide();}else{$("#showAllergies").hide();$("#Hide").show();}});$("#selectMedication").click(function(){if($(this).is(":checked")){$("#showMedication").show();$("#Hide").hide();}else{$("#showMedication").hide();$("#Hide").show();}});$("#selectConditions").click(function(){if($(this).is(":checked")){$("#showConditions").show();$("#Hide").hide();}else{$("#showConditions").hide();$("#Hide").show();}});$("#adopted").click(function(){if($(this).is(":checked")){$("#showAdoptionday").show();$("#Hide").hide();}else{$("#showAdoptionday").hide();$("#Hide").show();}});},backToHomeGr:function(){$(".backToHomeGr").on("click",function(){var sUrl="/grooming/petprofile/detail";window.location=sUrl;});},calendarFormat:function(){var name=$("#name").val();var d=$('#birthday').value=null;$('#birthday').datetimepicker({format:'DD/MM/YYYY',maxDate:d});$('#adoptionday').datetimepicker({format:'DD/MM/YYYY',maxDate:d});$('#dateDeath').datetimepicker({format:'DD/MM/YYYY',maxDate:d});},sizeType:function(){$(document).ready(function(){$("#groomingSizeType option[value="+"Pequeno"+"]").text("Pequeño");$("#groomingSpeciesType option[value="+"Mamiferos"+"]").text("Mamíferos");});},sendForm:function(){$("#sendForm").on("click",function(){var url=ACC.config.encodedContextPath+"/booking/petprofile/add";$.ajax({url:url,type:"POST",data:$("#petProfileForm").serialize(),success:function(response){console.log('Exito al gaurdar mascota');},complete:function(){location.reload();}});});},ShowComboSpecies:function(){$("#groomingSpeciesType").on("change",function(e){var url=ACC.config.encodedContextPath+"/grooming/comboBreed";console.log($("#groomingSpeciesType").val());console.log($("#groomingSpeciesType options:selected"));$.ajax({url:url,method:"GET",data:{code:$("#groomingSpeciesType").val()},dataType:"json",success:function(response){console.log(response);if(response){$("#primaryBreed option:not(:disabled)").remove();$.each(response,function(index,option){$("#primaryBreed").append('<option value="'+option.code+'">'+option.name+'</option>')});}}});});},ShowComboColor:function(){$("#groomingSpeciesType").on("change",function(e){var url=ACC.config.encodedContextPath+"/grooming/comboColor";console.log($("#groomingSpeciesType").val());console.log($("#groomingSpeciesType option:selected"));$.ajax({url:url,method:"GET",data:{code:$("#groomingSpeciesType").val()},dataType:"json",success:function(response){if(response){$("#color option:not(:disabled)").remove();$.each(response,function(index,option){$("#color").append('<option value="'+option.code+'">'+option.name+'</option>')});}}});});},bindScheduleAction:function(){$(document).on("click",".gm-choose-date",function(e){var element=$(e.target);var button=element.closest("button");if(button.data('requestRunning'))
return;button.data('requestRunning',true);var date=button.children(".gm-date").html();var displayDate=button.children("span").html()+" "+button.children("strong").html();$("#displayDate").val(displayDate);$("#grm-vacc-date").html(date);var store=$("#storeId").val();schedulePanel=$("#gm-scheduleacc");schedulePanel.slideUp();$(".gm-choose-date").removeClass("gm-button-selected");button.addClass("gm-button-selected");$.ajax({url:ACC.config.encodedContextPath+'/booking/grooming/schedule/'+store+"/60/"+date,type:'GET',data:{},success:function(response){$("#gm-scheduleacc").html(response);schedulePanel.slideDown();},error:function(jqXHR,textStatus,errorThrown){console.log('error');},complete:function(){button.data('requestRunning',false);}});});$(document).on("click",".gm-accordion",function(e){var element=$(e.target);var panel=element.closest(".gm-accordion");$(".gm-accordion").removeClass("gm-button-selected");panel.addClass("gm-button-selected");});},petImage:null,bindPetImageUpload:function(){$("#uploadPetImg").click(function(e){$("#uploadPetImg").attr('disabled','disabled');if(ACC.groomingDatePicker.petImage==null)
return;var petId=$("#imgPetId").val();var formData=new FormData();var xhr=new XMLHttpRequest();formData.append('image',ACC.groomingDatePicker.petImage,'petImage.png');$.ajax({url:ACC.config.encodedContextPath+'/grooming/'+petId+'/uploadImage',type:'POST',data:formData,processData:false,contentType:false,success:function(response)
{console.log('Carga de imagen completa');},error:function(jqXHR,textStatus,errorThrown)
{console.log('Error al cargar imagen');},complete:function()
{location.reload();}});});},resizePetImage:function(){var mime="image/png";var width=300;var height=300;var quality=1;var fileName="petProfileImage.png";var sourceImage=document.getElementById('petRawImage').files[0];const reader=new FileReader();reader.onload=function(event)
{const img=new Image();const elem=document.getElementById('petCanvas');elem.width=width;elem.height=height;const ctx=elem.getContext('2d');$("#petCanvas").removeAttr('style');img.onload=function()
{ctx.drawImage(img,0,0,width,height);ctx.stroke();ctx.canvas.toBlob((blob)=>{console.log(blob);const file=new File([blob],fileName,{type:mime,lastModified:Date.now()});console.log(file);ACC.groomingDatePicker.petImage=blob;$("#uploadPetImg").removeAttr('disabled');},mime,quality);}
var angleInDegrees=0;$("#rotate").removeAttr('disabled').click(function(){angleInDegrees-=90;drawRotated(angleInDegrees);});function drawRotated(degrees){ctx.clearRect(0,0,elem.width,elem.height);ctx.save();ctx.translate(elem.width/2,elem.height/2);ctx.rotate(degrees*(Math.PI/180));ctx.translate(-elem.width/2,-elem.height/2);ctx.drawImage(img,0,0,elem.width,elem.height);ctx.restore();ctx.canvas.toBlob((blob)=>{console.log(blob);const file=new File([blob],fileName,{type:mime,lastModified:Date.now()});console.log(file);ACC.groomingDatePicker.petImage=blob;$("#uploadPetImg").removeAttr('disabled');},mime,quality);}
$(".closeModal").on("click",function(){ctx.clearRect(0,0,width,height);$("#rotate").attr("disabled",'disabled');$("#petCanvas").attr("style",'height: 150px;');});img.src=event.target.result;};reader.readAsDataURL(sourceImage);},selectPetUpload:function(petId){$("#imgPetId").val(petId);}};